<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>8bitcow AR</title>

  <style>
    body { margin:0; overflow:hidden; background:#000; font-family: system-ui, -apple-system, sans-serif; }
    #ui{
      position:fixed; left:14px; right:14px; top:14px;
      background:rgba(0,0,0,0.80); color:#fff;
      padding:12px; border-radius:12px;
      z-index:2147483647;
    }
    button{ border:0; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; }
    #startBtn{ background:#2f7d32; color:#fff; }
    #status{ margin-left:10px; opacity:0.95; }
    #err{ margin-top:8px; font-size:12px; color:#ffb3b3; white-space:pre-wrap; display:none; }
  </style>

  <!-- MindAR v1.1.5 bundle (includes the three integration) -->
  <script src="./libs/mindar-image-three.prod.js"></script>
</head>
<body>
  <div id="ui">
    <button id="startBtn">Start Camera</button>
    <span id="status">Ready</span>
    <div id="err"></div>
  </div>

<script>
  const startBtn = document.getElementById('startBtn');
  const statusEl = document.getElementById('status');
  const errEl = document.getElementById('err');

  let mindarThree;

  function setStatus(s){ statusEl.textContent = s; }
  function showErr(e){
    errEl.style.display = 'block';
    errEl.textContent = (e && e.stack) ? e.stack : String(e);
    console.error(e);
  }

  startBtn.onclick = async () => {
    try {
      errEl.style.display = 'none'; errEl.textContent = '';
      if (!window.MINDAR?.IMAGE?.MindARThree) throw new Error("MindAR global missing (wrong file/path).");

      setStatus("Initializing…");

      mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: document.body,
        imageTargetSrc: "./targets.mind"
      });

      const { renderer, scene, camera } = mindarThree;

      const anchor = mindarThree.addAnchor(0);

      // Debug cube
      const cube = new THREE.Mesh(
        new THREE.BoxGeometry(0.5,0.5,0.5),
        new THREE.MeshNormalMaterial()
      );
      cube.position.y = 0.25;
      anchor.group.add(cube);

      setStatus("Requesting camera…");
      await mindarThree.start();

      setStatus("Running — point at marker");
      renderer.setAnimationLoop(() => renderer.render(scene, camera));

    } catch(e){
      setStatus("Failed");
      showErr(e);
    }
  };
</script>
</body>
</html>
